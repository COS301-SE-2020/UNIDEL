@model UniDelWebApplication.Models.User
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<body class="splash">
    <div class="container shadow p-3 mb-5 bg-white rounded">
        <div class="center">
            <div class="col-lg col-xl col-md col-lg">
                @if (ViewBag.CreateNew)
                {
                    @using (Html.BeginForm("CreateNewPassword", "Account", FormMethod.Post, new { id = "loginForm", @class = "form-card" }))
                    {
                        <input type="hidden" name="email" value="@Model.UserEmail" />
                        <input type="hidden" name="token" value="@Model.UserToken" />
                        <div class="form-group Info">
                            <label for="pass">New Password</label>
                            <input type="password" class="form-control" id="pass" name="pass" required placeholder="Password">
                            <small id="emailErrorMsg" class="error-msg text-danger" hidden>Password must be at least 6 characters and msut contain at least 1 capital letter and 1 digit</small>
                        </div>

                        <div class="form-group Info">
                            <label for="cpass">Confirm Password</label>
                            <input type="password" class="form-control" id="cpass" name="cpass" required placeholder="Confirm Password">
                            <small id="passErrorMsg" class="error-msg text-danger" hidden>Passwords should match</small>
                        </div>

                        <button type="submit" class="btn btn-block blue greenblue" style="margin:auto">Change Password</button>
                    }
                }
                else if (ViewBag.Success)
                {
                    <p class="text-body">Your password has been changed successfully</p>
                    <p class="text-body">@Html.ActionLink("Sign In", "Login", "Account")</p>
                }
                else if (ViewBag.ErrorID == 2)
                {
                    <p class="text-body">@ViewBag.Error</p>
                    <p class="text-body">@Html.ActionLink("Sign In", "Login", "Account")</p>
                }
                else
                {
                    <p class="text-body">@ViewBag.Error</p>
                    <p class="text-body">@Html.ActionLink("Resend Email", "ConfirmationSent", "Account")</p>
                }

            </div>
        </div>
    </div>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script>
    $(document).ready(function () {
        var validEmail = /^\w+([\.-]?\w+)*@@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
        var validPw = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,20}$/;
        $("small#emailErrorMsg").hide();
        $("small#passErrorMsg").hide();
        $("small#verfpassErrorMsg").hide();

        $("input#email").on("keyup", function () {
            var emInput = this.value;
            if (validEmail.test(emInput)) {
                $("small#emailErrorMsg").hide();
                $("input#email").removeClass("is-invalid");
                $("input#email").addClass("is-valid")
            } else {
                $("small#emailErrorMsg").show();
                if (!$("input#email").hasClass("is-invalid")) {
                    $("input#email").addClass("is-invalid");
                }
            }
        });

        $("input#pass").on("keyup", function () {
            var pwInput = this.value;
            if (validPw.test(pwInput)) {
                $("small#passErrorMsg").hide();
                $("input#pass").removeClass("is-invalid");
                $("input#pass").addClass("is-valid");
            } else {
                $("small#passErrorMsg").show();
                $("input#pass").removeClass("is-valid");
                if (!$("input#pass").hasClass("is-invalid")) {
                    $("input#pass").addClass("is-invalid");
                }
            }
        });

        $("input#cpass").on("keyup", function () {
            var originalPass = $("input#pass").val();
            var confPass = this.value;

            if (confPass == originalPass && $("input#pass").hasClass("is-valid")) {
                $("small#verfpassErrorMsg").hide();
                $("input#cpass").removeClass("is-invalid");
                $("input#cpass").addClass("is-valid");
            } else {
                $("small#verfpassErrorMsg").show();
                $("input#cpass").removeClass("is-valid");
                if (!$("input#cpass").hasClass("is-invalid")) {
                    $("input#cpass").addClass("is-invalid");
                }
            }
        });
    });
    </script>
</body>